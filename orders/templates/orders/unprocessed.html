{% extends 'base.html' %}
{% load l10n %}

{% block content %}

<style>
    /* –ú—ã —É–±—Ä–∞–ª–∏ :root –∏ body. 
       –¢–µ–ø–µ—Ä—å —Ü–≤–µ—Ç–∞ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç base.html (var(--bg-card), var(--text-main) –∏ —Ç.–¥.)
    */

    /* –í–∫–ª–∞–¥–∫–∏ (–∫–∞–∫ –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö) */
    .nav-tabs-custom { display: flex; gap: 20px; margin-bottom: 24px; border-bottom: 1px solid var(--border-color); padding-left: 10px; }
    .nav-tab { color: var(--text-muted); text-decoration: none; padding: 12px 4px; font-size: 14px; border-bottom: 2px solid transparent; transition: 0.2s; }
    .nav-tab:hover { color: var(--text-main); }
    .nav-tab.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); font-weight: 600; }

    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–ª–∞—à–∫–∞ */
    .alert-custom-blue {
        background-color: rgba(61, 90, 254, 0.1);
        border: 1px solid rgba(61, 90, 254, 0.2);
        color: var(--accent-blue);
        border-radius: 6px;
        padding: 12px 16px;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
    }
    .alert-custom-blue i { font-size: 14px; }

    /* ===== MINI DEBUG (—Ç–æ–ª—å–∫–æ —Å—Ç–∏–ª–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–µ –ª–æ–º–∞–µ–º) ===== */
    .alert-debug {
        background-color: rgba(247, 166, 0, 0.06);
        border: 1px solid rgba(247, 166, 0, 0.22);
        color: #f3d48c;
        border-radius: 6px;
        padding: 12px 16px;
        font-size: 12px;
        margin-bottom: 20px;
    }
    /* –í —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ —Ç–µ–∫—Å—Ç –¥–µ–±–∞–≥–∞ –¥–µ–ª–∞–µ–º –ø–æ—Ç–µ–º–Ω–µ–µ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
    [data-bs-theme="light"] .alert-debug { color: #b47d00; }

    .alert-debug__title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        font-weight: 700;
        margin-bottom: 8px;
    }
    .alert-debug__badge {
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 999px;
        border: 1px solid rgba(247, 166, 0, 0.35);
        color: #f7a600;
        background: rgba(0,0,0,0.15);
        white-space: nowrap;
    }
    .alert-debug pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-word;
        padding: 10px 12px;
        border-radius: 6px;
        background: rgba(0,0,0,0.35); /* –§–æ–Ω –∫–æ–¥–∞ –≤—Å–µ–≥–¥–∞ —Ç–µ–º–Ω—ã–π */
        border: 1px solid rgba(255,255,255,0.06);
        color: #d9d9d9;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 11px;
        line-height: 1.45;
        max-height: 220px;
        overflow: auto;
    }
    /* ========================================================= */

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–±–ª–∏—Ü—ã */
    .table-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        overflow: hidden;
    }

    /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Ç–∞–±–ª–∏—Ü—ã (–ü–∞–≥–∏–Ω–∞—Ü–∏—è) */
    .table-header-panel {
        display: flex;
        justify-content: flex-end; /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–ø—Ä–∞–≤–∞ */
        padding: 10px 15px;
        border-bottom: 1px solid var(--border-color);
    }

    .pagination-controls {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-page {
        background: var(--bg-input); /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Ç–µ–º—ã */
        border: 1px solid var(--border-color);
        color: var(--text-main);
        width: 24px;
        height: 24px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        cursor: pointer;
    }
    .btn-page:hover { background: var(--border-color); }
    .page-info { font-size: 12px; color: var(--text-muted); }

    /* –¢–∞–±–ª–∏—Ü–∞ */
    .table { margin-bottom: 0; font-size: 13px; color: var(--text-main); }
    .table thead th {
        background-color: var(--bg-input); /* –§–æ–Ω –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ–º—ã */
        color: var(--text-muted);
        font-weight: 500;
        font-size: 11px;
        text-transform: uppercase;
        border-bottom: 1px solid var(--border-color);
        padding: 12px 15px;
    }
    .table td {
        border-bottom: 1px solid var(--border-color);
        padding: 10px 15px;
        vertical-align: middle;
    }
    .table tr:last-child td { border-bottom: none; }

    /* –°—Ç–∏–ª–∏ –∫–æ–ª–æ–Ω–æ–∫ */
    .col-id { font-weight: 600; color: var(--text-main); } /* –¶–≤–µ—Ç ID –º–µ–Ω—è–µ—Ç—Å—è –æ—Ç —Ç–µ–º—ã */
    .col-type-buy { color: var(--text-muted); }
    .col-type-sell { color: var(--text-muted); }

    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .btn-bybit {
        background-color: #f7a600; /* –ñ–µ–ª—Ç—ã–π Bybit –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å */
        color: #000;
        font-weight: 600;
        font-size: 11px;
        padding: 4px 12px;
        border-radius: 4px;
        text-decoration: none;
        border: none;
        display: inline-block;
    }
    .btn-bybit:hover { background-color: #e59b00; color: #000; }

    .btn-delete-row {
        background-color: rgba(248, 73, 96, 0.1); /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –∫—Ä–∞—Å–Ω—ã–π */
        color: var(--danger);
        border: 1px solid var(--danger);
        font-size: 11px;
        padding: 4px 12px;
        border-radius: 4px;
        text-decoration: none;
        margin-left: 6px;
        transition: 0.2s;
    }
    .btn-delete-row:hover {
        background-color: var(--danger);
        color: #fff;
    }

    /* –°–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã */
    .table-responsive::-webkit-scrollbar { height: 6px; }
    .table-responsive::-webkit-scrollbar-track { background: var(--bg-card); }
    .table-responsive::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
</style>


<div class="container-fluid px-0">

    <div class="alert-custom-blue">
        <span>‚ÑπÔ∏è</span> –û—Ä–¥–µ—Ä–∞ —Å –±–∏—Ä–∂ HTX –∏ MEXC –ø–æ–∫–∞ –Ω–µ –≤—ã–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ —ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª
    </div>

    {# ===== MINI DEBUG: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –≤–µ—Ä–Ω—É–ª Bybit sync ===== #}
    {% if sync_debug %}
    <div class="alert-debug">
        <div class="alert-debug__title">
            <span>üõ†Ô∏è Debug —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ Bybit</span>
            {% if sync_debug.ok %}
                <span class="alert-debug__badge">OK</span>
            {% else %}
                <span class="alert-debug__badge">ERROR</span>
            {% endif %}
        </div>
        <pre>{{ sync_debug|pprint }}</pre>
    </div>
    {% endif %}
    {# ============================================================= #}

    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>ID –æ—Ä–¥–µ—Ä–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–¶–µ–Ω–∞</th>
                    <th>–ö–æ–ª-–≤–æ</th>
                    <th>–°–æ–∑–¥–∞–Ω</th>
                    <th class="text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for item in unprocessed_orders %}
                <tr>
                    <td class="col-id">{{ item.order_id }}</td>

                    <td>
                        {% if item.operation_type == 'BUY' %}
                            <span class="col-type-buy">–ü–æ–∫—É–ø–∫–∞</span>
                        {% else %}
                            <span class="col-type-sell">–ü—Ä–æ–¥–∞–∂–∞</span>
                        {% endif %}
                    </td>

                    <td>{{ item.price|default:"‚Äî" }}</td>

                    <td>{{ item.amount }}</td>

                    <td class="text-muted">{{ item.created_at|date:"d.m.Y, H:i:s" }}</td>

                    <td class="text-end">
                        <a href="https://www.bybit.com/ru-RU/p2p/orderList/{{ item.order_id }}" target="_blank" class="btn-bybit">
                            Bybit
                        </a>
                        <a href="#" class="btn-delete-row" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞?')">
                            –£–¥–∞–ª–∏—Ç—å
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-5 text-muted">
                        –°–ø–∏—Å–æ–∫ –ø—É—Å—Ç. –ù–æ–≤—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

{% endblock %}