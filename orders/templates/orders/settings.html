{% extends 'base.html' %}
{% block content %}
<style>
    .settings-container {
        /* ИЗМЕНЕНО: Было 900px, ставим 100%, чтобы заполнить весь контейнер из base.html */
        max-width: 100%; 
        margin: 20px auto;
        background: var(--bg-card); /* Переменная темы */
        border: 1px solid var(--border-color); /* Переменная темы */
        border-radius: 12px;
        padding: 30px;
    }

    /* Декоративные заголовки разделов с линиями */
    .section-divider {
        display: flex;
        align-items: center;
        text-align: center;
        color: var(--text-muted); /* Переменная темы */
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin: 30px 0 20px;
    }
    .section-divider::before, .section-divider::after {
        content: '';
        flex: 1;
        border-bottom: 1px solid var(--border-color); /* Переменная темы */
    }
    .section-divider:not(:empty)::before { margin-right: 15px; }
    .section-divider:not(:empty)::after { margin-left: 15px; }

    .field-label {
        font-size: 0.8rem;
        color: var(--text-muted); /* БЫЛО #fff -> СТАЛО var(--text-muted) для поддержки светлой темы */
        margin-bottom: 6px;
        display: block;
    }

    .form-control, .form-select {
        height: 42px;
        font-size: 0.9rem;
        margin-bottom: 15px;
        background-color: var(--bg-input) !important; /* Переменная темы */
        border: 1px solid var(--border-color) !important; /* Переменная темы */
        color: var(--text-main) !important; /* Переменная темы */
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--accent-blue) !important;
        box-shadow: 0 0 0 2px rgba(61, 90, 254, 0.2);
    }

    .btn-save {
        background: var(--bg-input); /* Фон кнопки подстраивается под тему */
        border: 1px solid var(--accent-blue);
        color: var(--text-main);
        padding: 8px 25px;
        border-radius: 6px;
        font-size: 0.85rem;
        transition: 0.3s;
        font-weight: 500;
    }
    /* В светлой теме делаем текст кнопки синим для акцента */
    [data-bs-theme="light"] .btn-save {
        color: var(--accent-blue);
    }
    
    .btn-save:hover { 
        background: var(--accent-blue); 
        color: #fff !important; /* При наведении текст всегда белый */
    }
    
    .footer-link {
        text-align: center;
        font-size: 0.75rem;
        color: var(--text-muted); /* Переменная темы */
        margin-top: 20px;
    }
</style>

<div class="settings-container shadow-sm">
    <form method="post">
        {% csrf_token %}

        <div class="section-divider">Онлайн-касса</div>
        <div class="row">
            <div class="col-md-6">
                <label class="field-label">API логин Эвотора</label>
                <input type="text" name="evotor_login" class="form-control" value="{{ user.evotor_login|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="field-label">API пароль Эвотора</label>
                <input type="text" name="evotor_password" class="form-control" value="{{ user.evotor_password|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="field-label">Идентификатор группы ККТ</label>
                <input type="text" name="kkt_id" class="form-control" value="{{ user.kkt_id|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="field-label">Email</label>
                <input type="email" name="email" class="form-control" value="{{ user.email|default:'' }}">
            </div>
            <div class="col-12">
                <label class="field-label">Место расчетов</label>
                <input type="text" name="payment_address" class="form-control" value="{{ user.payment_address|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="field-label">Тип налогообложения</label>
                <select name="tax_type" class="form-select">
                    <option value="OCH" {% if user.tax_type == 'OCH' %}selected{% endif %}>OCH</option>
                    
                    <option value="OSNO" {% if user.tax_type == 'OSNO' %}selected{% endif %}>ОСНО</option>
                    
                    <option value="USN_INCOME" {% if user.tax_type == 'USN_INCOME' %}selected{% endif %}>УСН доход</option>
                    <option value="USN_INCOME_OUTCOME" {% if user.tax_type == 'USN_INCOME_OUTCOME' %}selected{% endif %}>УСН доход-расход</option>
                    <option value="PATENT" {% if user.tax_type == 'PATENT' %}selected{% endif %}>Патент</option>
                </select>
            </div>
            <div class="col-md-6">
                <label class="field-label">ИНН</label>
                <input type="text" name="inn" class="form-control" value="{{ user.inn|default:'' }}">
            </div>
        </div>

        <div class="section-divider">HTX API</div>
        <div class="row">
            <div class="col-md-6">
                <label class="field-label">HTX Access Key</label>
                <input type="text" name="htx_key" class="form-control" value="{{ user.htx_access_key|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="field-label">HTX Private Key</label>
                <input type="text" name="htx_secret" class="form-control" value="{{ user.htx_private_key|default:'' }}">
            </div>
        </div>

        <div class="section-divider">MEXC API</div>
        <div class="row">
            <div class="col-md-6">
                <label class="field-label">MEXC API Key</label>
                <input type="text" name="mexc_key" class="form-control" value="{{ user.mexc_api_key|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="field-label">MEXC API Secret</label>
                <input type="text" name="mexc_secret" class="form-control" value="{{ user.mexc_api_secret|default:'' }}">
            </div>
        </div>

        <div class="section-divider">Bybit API</div>
        <div class="row">
            <div class="col-md-6">
                <label class="field-label">Bybit API Key</label>
                <input type="text" name="bybit_key" class="form-control" value="{{ user.bybit_api_key|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="field-label">Bybit API Secret</label>
                <input type="text" name="bybit_secret" class="form-control" value="{{ user.bybit_api_secret|default:'' }}">
            </div>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-save">Сохранить настройки</button>
        </div>
    </form>
</div>

<div class="footer-link">
    t.me/+crR3oCuIaJFjZWZi
</div>
{% endblock %}