{% extends 'admin/admin_base.html' %}

{% block title %}–†–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–∫–∞–∑–æ–≤ | –ê–¥–º–∏–Ω–∫–∞{% endblock %}

{% block extra_css %}
<style>
    /* –°—Ç–∏–ª–∏ –∏–∑ —Ç–≤–æ–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ */
    .form-section { background:#111520; border-radius:10px; padding:16px; margin-bottom:16px; border:1px solid var(--border-color); }
    .form-section h3 { color:var(--text-main); margin-bottom:16px; font-size:14px; font-weight:500; }
    .info-field { padding:10px 14px; background:rgba(108,140,255,.05); border:1px solid var(--border-color); border-radius:8px; font-size:13px; color:var(--text-main); font-family:'Courier New', monospace; word-break: break-all; }
    .form-row { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:12px; }
    .form-group { margin-bottom:16px; }
    .form-group label { display:block; margin-bottom:6px; color:var(--text-muted); font-size:12px; font-weight:500; }
    .button-group { display:flex; gap:10px; flex-wrap:wrap; margin-top:16px; }
    
    /* –î–æ–ø. —Å—Ç–∏–ª–∏ –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ */
    .alert { padding: 12px; border-radius: 8px; font-size: 14px; margin-bottom: 16px; border: 1px solid transparent; }
    .alert-success { background: rgba(88,214,141,0.1); color: #58d68d; border-color: rgba(88,214,141,0.2); }
    .alert-danger { background: rgba(255,108,108,0.1); color: #ff6c6c; border-color: rgba(255,108,108,0.2); }
</style>
{% endblock %}

{% block content %}
<div class="section">
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}success{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="form-section">
        <h3>üîç –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–∞ –ø–æ External ID</h3>
        <form method="GET" action="{% url 'admin_orders_editor' %}">
            <div class="form-row">
                <div class="form-group">
                    <label>–ë–∏—Ä–∂–µ–≤–æ–π ID (external_id)</label>
                    <input class="form-control" type="text" name="order_id_search" 
                           value="{{ request.GET.order_id_search|default:'' }}" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –æ—Ä–¥–µ—Ä–∞...">
                </div>
                <div class="form-group">
                    <label>–ë–∏—Ä–∂–∞</label>
                    <select class="form-select" name="exchange_type_search">
                        <option value="1">Bybit</option>
                        <option value="2">HTX</option>
                        <option value="3">MEXC</option>
                    </select>
                </div>
                <div class="form-group d-flex align-items-end">
                    <button type="submit" class="btn btn-outline-blue w-100" style="height: 38px;">–ù–∞–π—Ç–∏</button>
                </div>
            </div>
        </form>
    </div>

    {% if order %}
    <div class="form-section">
        <h3>üìù –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞</h3>
        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="target_order_pk" value="{{ order.pk }}">
            
            <div class="form-row">
                <div class="form-group">
                    <label>External ID (–ë–∏—Ä–∂–∞)</label>
                    <div class="info-field">{{ order.external_id }}</div>
                </div>
                <div class="form-group">
                    <label>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</label>
                    <div class="info-field">{{ order.user.username }}</div>
                </div>
                <div class="form-group">
                    <label>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
                    <select class="form-select" name="operation_type">
                        <option value="BUY" {% if order.operation_type == 'BUY' %}selected{% endif %}>–ü–æ–∫—É–ø–∫–∞ (BUY)</option>
                        <option value="SELL" {% if order.operation_type == 'SELL' %}selected{% endif %}>–ü—Ä–æ–¥–∞–∂–∞ (SELL)</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>–¶–µ–Ω–∞ (Price)</label>
                    <input class="form-control" type="number" name="price" step="0.01" value="{{ order.price|stringformat:'.2f' }}">
                </div>
                <div class="form-group">
                    <label>–°—É–º–º–∞ (Amount RUB)</label>
                    <input class="form-control" type="number" name="amount" step="0.01" value="{{ order.amount|stringformat:'.2f' }}">
                </div>
                <div class="form-group">
                    <label>–û–±—ä–µ–º (Cost/Quantity)</label>
                    <input class="form-control" type="number" name="cost" step="0.00000001" value="{{ order.cost|stringformat:'.8f' }}">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>–ö–æ–º–∏—Å—Å–∏—è</label>
                    <input class="form-control" type="number" name="commission" step="0.01" value="{{ order.commission|default:'0.00' }}">
                </div>
                <div class="form-group">
                    <label>–¢–∏–ø –∫–æ–º–∏—Å—Å–∏–∏</label>
                    <select class="form-select" name="commission_type">
                        <option value="PERCENT" {% if order.commission_type == 'PERCENT' %}selected{% endif %}>–ü—Ä–æ—Ü–µ–Ω—Ç</option>
                        <option value="MONEY" {% if order.commission_type == 'MONEY' %}selected{% endif %}>–î–µ–Ω—å–≥–∏</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</label>
                    <input class="form-control" type="datetime-local" name="created_at" value="{{ order.created_at|date:'Y-m-d\TH:i' }}">
                </div>
            </div>
            
            <div class="button-group">
                <button type="submit" name="save_order" class="btn btn-outline-blue px-4">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                {% if order.screenshot %}
                <a href="{{ order.screenshot.url }}" class="btn btn-outline-success" target="_blank">üì∑ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç</a>
                {% endif %}
            </div>
        </form>
    </div>
    {% endif %}

    <div class="form-section">
        <h3>üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</h3>
        <div class="form-row">
            <div class="form-group">
                <label>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (ID)</label>
                <input class="form-control" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ ID">
            </div>
            <div class="form-group">
                <label>–î–∞—Ç–∞ —Å</label>
                <input class="form-control" type="date">
            </div>
            <div class="form-group d-flex align-items-end">
                <button class="btn btn-outline-success w-100" style="height: 38px;">üì• –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}